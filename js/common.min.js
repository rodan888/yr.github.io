$(function(){function t(){var t=$("style.cp-pen-styles").text();n.html(t)}var e={alert:$(".alert-massege"),btnMenu:$(".btn-menu"),btnSearch:$("#tags-search-button"),tagsContainer:$("#tags"),pinContainer:$(".pin-container"),loader:$(".loader-wrap"),nav:$(".menu-container nav"),loader:$(".loader-wrap"),slider:$("#carousel"),sliderItem:$("#slide-item"),imgParallax:$(".parralax"),headerParallax:$("header.big-header"),popupBtn:$(".popup-btn"),popupContainer:$(".popup"),owlOptions:{autoPlay:3e3,navigation:!0,items:4,autoPlay:!1,pagination:!1,scrollPerPage:!0,navigationText:['<i class="fa fa-angle-left"></i>','<i class="fa fa-angle-right"></i>'],itemsDesktop:[1199,3],itemsDesktopSmall:[979,3]},owlSingl:{autoPlay:!1,navigation:!0,items:1,autoPlay:!1,pagination:!0,scrollPerPage:!0,navigationText:['<i class="fa fa-angle-left"></i>','<i class="fa fa-angle-right"></i>'],itemsDesktop:[1199,3],itemsDesktopSmall:[979,3]},masonryOptins:{columnWidth:".item",itemSelector:".item"},flag:!0,docHeight:"",winHeight:$(window).height(),footerHeight:$("footer").height(),headerHeight:$("header").height(),scroll:"",ajaxReturn:[],pagination:1,ajaxPinUrl:function(){return this.pinContainer.data("url")},paginatinoIndex:function(){for(var t=this.sliderItem.find(".owl-pagination .owl-page"),e=0;e<t.length;e++)t.eq(e).find("span").html(e+1)},toggleFunk:function(t,e,i){t.on("click",function(){$(this).toggleClass(i),e.slideToggle("slow")})},popup:function(t){this.popupBtn.on("click",function(e){e.preventDefault();var i=$(this).data("popup"),n=$("#"+i);n.fadeIn("slow").css("height",t+"px").find("form").append('<span class="fade_out">&#9587;</span>'),$(".fade_out").click(function(){n.fadeOut("slow"),$(this).detach()})})},ajaxPin:function(){var t=this;$.ajax({url:t.ajaxPinUrl()+"?page="+t.pagination,type:"GET",dataType:"json",data:t.pagination,beforeSend:function(){t.flag=!1,t.loader.fadeIn("fast")}}).done(function(e){if(0==!e.pinlist.length){for(var i=0;i<e.pinlist.length;i++)"add"==e.pinlist[i].personal?t.ajaxReturn.push('<div class="col-md-3 col-sm-4 item"> <div class="pin"> <div class="img-wrap"><div class="add-block"> <a data-id="'+e.pinlist[i].id+'" data-type="pin" class="add-button addToPersonal" href="#">+ Добавить</a></div><a href="'+e.pinlist[i].link+'"><img src="'+e.pinlist[i].img+'" alt="pin"></a></div><div class="descr"><h3><a href="'+e.pinlist[i].link+'">'+e.pinlist[i].title+"</a></h3><p>"+e.pinlist[i].descr+"</p></div></div></div>"):"added"==e.pinlist[i].personal?t.ajaxReturn.push('<div class="col-md-3 col-sm-4 item"> <div class="pin"> <div class="img-wrap"><div class="add-block"> <a class="add-button" onclick="return false;" href="#">Добавлен</a></div><a href="'+e.pinlist[i].link+'"><img src="'+e.pinlist[i].img+'" alt="pin"></a></div><div class="descr"><h3><a href="'+e.pinlist[i].link+'">'+e.pinlist[i].title+"</a></h3><p>"+e.pinlist[i].descr+"</p></div></div></div>"):t.ajaxReturn.push('<div class="col-md-3 col-sm-4 item"> <div class="pin"> <div class="img-wrap"><a href="'+e.pinlist[i].link+'"><img src="'+e.pinlist[i].img+'" alt="pin"></a></div><div class="descr"><h3><a href="'+e.pinlist[i].link+'">'+e.pinlist[i].title+"</a></h3><p>"+e.pinlist[i].descr+"</p></div></div></div>");t.pinContainer.append(t.ajaxReturn).masonry("reloadItems").masonry("layout"),t.addPin(),t.removePin(),t.loader.fadeOut("fast"),t.flag=!0,t.pagination++,t.ajaxReturn.length=0}else console.log("Закончились все)"),t.loader.detach()}).fail(function(){console.log("error"),t.loader.detach()})},toggleInit:function(){this.toggleFunk(this.btnMenu,this.nav,"open-menu"),this.toggleFunk(this.btnSearch,this.tagsContainer,"open")},mouseParallax:function(){var t=$(window).width(),e=$("header").height(),i=this;this.headerParallax.mousemove(function(n){var a=n.pageX,o=n.pageY,a=a-Math.floor(t/2),o=o-Math.floor(e/2);i.imgParallax.css({"-webkit-transform":"translateY("+-a/20+"px) translateX("+-o/20+"px)",transform:"translateY("+-a/20+"px) translateX("+-o/20+"px)"})})},customVideo:function(){},scrollEvent:function(){var t=this;$(window).on("scroll",function(){t.scroll=$(this).scrollTop(),t.docHeight=$(document).outerHeight(),t.scroll>t.headerHeight?t.btnMenu.addClass("purpure"):t.btnMenu.removeClass("purpure"),t.scroll>t.docHeight-t.winHeight-t.footerHeight&&$("#pin-list .ajax").length>0?(t.loader.css("display","block"),t.flag&&t.ajaxPin()):t.loader.css("display","none")})},toggleMassege:function(){var t=this,e=function(){t.alert.detach()};setTimeout(e,5e3)},addPin:function(){$(".addToPersonal").on("click",function(t){var e=$(this);$.ajax({type:"GET",url:"/my/add/"+e.data("id")+"/"+e.data("type")}).done(function(t){switch(t.status){case 0:console.log("error");break;case 1:console.log("success"),e.removeClass("addToPersonal").html("Добавлен");break;case 2:console.log("already added"),e.removeClass("addToPersonal").html("Добавлен")}}),t.preventDefault()})},removePin:function(){$(".deleteFromPersonal").on("click",function(t){var e=$(this);$.ajax({type:"GET",url:"/my/delete/"+e.data("id")}).done(function(t){switch(t.status){case 0:console.log("error");break;case 1:console.log("success"),e.closest(".item").remove()}}),t.preventDefault()})},init:function(){this.toggleInit(),this.slider.owlCarousel(this.owlOptions),this.sliderItem.owlCarousel(this.owlSingl),this.scrollEvent(),this.popup(this.winHeight),this.mouseParallax(),this.paginatinoIndex(),this.toggleMassege(),this.addPin(),this.removePin()}};$(document).ajaxComplete(function(){e.pinContainer.masonry("reloadItems").masonry()}),$(document).ready(function(){var t=$(".pin-inside .add-block");t.next().is("iframe")&&t.addClass("iframe"),$(".video-prev-wrap").click(function(){var t=$(this).data("youtube");$(this).addClass("play"),$(this).html('<iframe height="360" src="http://www.youtube.com/embed/'+t+'?autoplay=1"  frameborder="0" allowfullscreen></iframe>')}),$(".pin-inside iframe").width($(".pin-inside").width()),$("img, a").on("dragstart",function(t){t.preventDefault()}),$("body").css("min-height",$(window).height()+"px"),e.init(),$(".gmap").each(function(){var t=this,e={zoom:$(t).data("zoom"),zoomControl:!0,mapTypeControl:!1,streetViewControl:!1,scrollwheel:!1,draggable:!0,mapTypeId:google.maps.MapTypeId.ROADMAP},i=new google.maps.Map(t,e),n=new google.maps.Geocoder;n.geocode({address:$(t).data("address")},function(e,n){n===google.maps.GeocoderStatus.OK&&(new google.maps.Marker({position:e[0].geometry.location,map:i,icon:$(t).data("marker")}),i.setCenter(e[0].geometry.location))})})}),$(window).on("load",function(){e.pinContainer.masonry(e.masonryOptins)});var i=$("#refresh"),n=$("#css_result");t(),i.click(t),n.click(function(){$(this).select()})});